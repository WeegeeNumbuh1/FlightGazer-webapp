<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlightGazer Config Editor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        .help-text { font-size: 0.95em; color: #666; margin-bottom: 0.5em; }
        .tab-content { margin-top: 1.5em; }
        .apply-btn { display: none; position: fixed; bottom: 30px; right: 30px; z-index: 1000; }
        .api-schedule-table td, .api-schedule-table th { text-align: center; vertical-align: middle; }
        .color-preview { width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; }
        .setting-label { font-weight: 600; font-size: 1.08em; color: #7b86ff; }
        .form-range { background-color: #0e0e0e2e; }
        .inline-image { max-width: 256px; }
    </style>
</head>
<body>
<div class="container py-4" style="margin-bottom:6em;">
    <a href="{{ url_for('landing_page') }}" class="btn btn btn-info">&larr; Back to Home</a>
    <h2>FlightGazer Configuration Editor</h2>
    <div class="help-text"><i>Hint: Configure of all your settings first before pressing the "Save" button.</i></div>
    <ul class="nav nav-tabs" id="configTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">General</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab">API</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="screen-tab" data-bs-toggle="tab" data-bs-target="#screen" type="button" role="tab">Screen Output</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="brightness-tab" data-bs-toggle="tab" data-bs-target="#brightness" type="button" role="tab">Brightness</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab">Advanced</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="rgb-tab" data-bs-toggle="tab" data-bs-target="#rgb" type="button" role="tab">RGB-Matrix</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="colors-tab" data-bs-toggle="tab" data-bs-target="#colors" type="button" role="tab">Colors</button>
        </li>
    </ul>
    <form id="configForm">
    <div class="tab-content">
        <!-- General Tab -->
        <div class="tab-pane fade show active" id="general" role="tabpanel">
            <div class="mt-3">
                <label for="units" class="form-label setting-label">Units</label>
                <div class="help-text">
                    <ul>
                        <li>Aeronautical (nmi, ft, kt) [default]</li>
                        <li>Metric (km, m, km/h)</li>
                        <li>Imperial (mi, ft, mph)</li>
                    </ul>
                </div>
                <select class="form-select" id="UNITS" name="UNITS">
                    <option value="0" {% if config.UNITS == 0 %}selected{% endif %}>Aeronautical</option>
                    <option value="1" {% if config.UNITS == 1 %}selected{% endif %}>Metric</option>
                    <option value="2" {% if config.UNITS == 2 %}selected{% endif %}>Imperial</option>
                </select>
            </div>
            <div class="mt-3">
                <label for="HEIGHT_LIMIT" class="form-label setting-label">Height Limit</label>
                <div class="help-text">
                    Aircraft at an altitude lower than this will be considered for detailed tracking on the display.<br>
                    <i>Default: 15000 feet</i>
                </div>
                <div class="input-group">
                    <!-- Limits when (UNITS = 0 or 2): min="2500", max="75000"
                    (UNITS = 1): min="760", max="22860" -->
                    <input type="range" class="form-range" min="2500" max="75000" step="5" id="HEIGHT_LIMIT" name="HEIGHT_LIMIT" value="{{ config.HEIGHT_LIMIT }}" oninput="HEIGHT_LIMIT_num.value = this.value">
                    <input type="number" class="form-control" min="2500" max="75000" step="5" id="HEIGHT_LIMIT_num" value="{{ config.HEIGHT_LIMIT }}" style="max-width:100px; margin-left:8px;" oninput="HEIGHT_LIMIT.value = this.value">
                    <span id="aUnit" style="margin-left: 8px; align-content: center;"></span>
                </div>
            </div>
            <div class="mt-3">
                <label for="RANGE" class="form-label setting-label">Range</label>
                <div class="help-text">
                    Aircraft within this radius from your location will be considered for detailed tracking on the display.<br>
                    This setting does not limit the range of your receiver.<br>
                    To see how big of an area a certain radius is on a map, <a href="https://www.mapdevelopers.com/draw-circle-tool.php" target="_blank" rel="noopener noreferrer">use this online tool</a> (opens a new tab).<br>
                    <i>If you are near an airport or inline with a runway, 2 nmi (2.3 mi, 3.7 km) or less works best.</i><br>
                </div>
                <div class="input-group">
                    <!-- Limits when (UNITS = 0): min="0.5" max="20"
                    (UNITS = 1): min="0.9" max="37"
                    (UNITS = 2): min="0.6" max="23" -->
                    <input type="range" class="form-range" min="0.5" max="20" step="0.1" id="RANGE" name="RANGE" value="{{ config.RANGE }}" oninput="RANGE_num.value = this.value">
                    <input type="number" class="form-control" min="0.5" max="20" step="0.1" id="RANGE_num" value="{{ config.RANGE }}" style="max-width:100px; margin-left:8px;" oninput="RANGE.value = this.value">
                    <span id="dUnit" style="margin-left: 8px; align-content: center;"></span>
                    <!-- <output id="RANGE_value" style="margin-left:8px;">{{ config.RANGE }}</output> -->
                </div>
            </div>
        </div>
        <!-- API Tab -->
        <div class="tab-pane fade" id="api" role="tabpanel">
            <div class="mt-3">
                <label for="API_KEY" class="form-label setting-label">API Key</label>
                <div class="help-text">
                    Put your FlightAware API key here. Leave blank to not use the API.<br>
                    <h5>Having an API key will enable the journey readout (the origin and departure) data for an aircraft.</h5><br>
                    Don't have one? Sign up at <a href="https://www.flightaware.com/commercial/aeroapi/#compare-plans-section" target="_blank" rel="noopener noreferrer">FlightAware</a>. (There is a free tier, billing information required)
                </div>
                <input type="text" class="form-control" id="API_KEY" name="API_KEY" value="{{ config.API_KEY }}" style="font-family: monospace;">
            </div>
            <div class="mt-3">
                <label for="API_DAILY_LIMIT" class="form-label setting-label">API Daily Limit</label>
                <div class="help-text">
                    Type in an integer to limit the amount of API calls in a day.<br>
                    Leave this blank for unlimited calls.
                </div>
                <input type="number" step="1" class="form-control" id="API_DAILY_LIMIT" name="API_DAILY_LIMIT" value="{{ config.API_DAILY_LIMIT or '' }}" min="1" max="10000">
            </div>
            <div class="mt-3">
                <label for="API_COST_LIMIT" class="form-label setting-label">API Cost Limit</label>
                <div class="help-text">
                    Limit API usage of the provided API key based on its running cost over the past 30 days. (ex: $10.00)<br>
                    If the cost exceeds this value, API calls will stop and will not resume until there are credits available again.<br>
                    If the cost upon startup exceeds this value, the API will not be used but will start if there are credits available at a later time.<br>
                    Leave this blank to have no limit.
                </div>
                <input type="number" step="0.01" class="form-control" id="API_COST_LIMIT" name="API_COST_LIMIT" value="{{ config.API_COST_LIMIT }}" min="0.01" max="10000">
            </div>
            <div class="mt-3">
                <label class="form-label setting-label">API Schedule</label>
                <div class="help-text">
                    Set hours when the API can be used.<br>
                    If this setting is disabled, the API can be used at all times.<br>
                    <i>On mobile screens, you might need to scroll to the right →</i>
                </div>
                <div class="form-check form-switch mb-2">
                    <input class="form-check-input" type="checkbox" id="API_SCHEDULE_ENABLED" name="API_SCHEDULE_ENABLED" {% if config.API_SCHEDULE.ENABLED %}checked{% endif %}>
                    <label class="form-check-label" for="API_SCHEDULE_ENABLED">Enable API Schedule</label>
                </div>
                <table class="table table-bordered api-schedule-table">
                    <thead>
                        <tr><th></th><th colspan="12">AM</th><th colspan="12">PM</th></tr>
                        <tr><th>Day ↓ | Hour →</th>{% for h in range(0,24) %}<th>{{ h }}</th>{% endfor %}</tr>
                    </thead>
                    <tbody>
                    {% for day in ['SUNDAY','MONDAY','TUESDAY','WEDNESDAY','THURSDAY','FRIDAY','SATURDAY'] %}
                        <tr>
                            <td>{{ day.title() }}</td>
                            {% set am = config.API_SCHEDULE[day]['0-11'] %}
                            {% set pm = config.API_SCHEDULE[day]['12-23'] %}
                            {% for i in range(12) %}
                                <td><input type="checkbox" class="api-hour" data-day="{{day}}" data-hour="{{i}}" {% if am[i]=='x' %}checked{% endif %}></td>
                            {% endfor %}
                            {% for i in range(12) %}
                                <td><input type="checkbox" class="api-hour" data-day="{{day}}" data-hour="{{i+12}}" {% if pm[i]=='x' %}checked{% endif %}></td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Screen Output Tab -->
        <div class="tab-pane fade" id="screen" role="tabpanel">
            <div class="mt-3">
                <img src="{{ url_for('static', filename='FG-journey-plus-default.png') }}" class="inline-image">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="JOURNEY_PLUS" name="JOURNEY_PLUS" {% if config.JOURNEY_PLUS %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="JOURNEY_PLUS">Journey Plus</label>
                </div>
                <div class="help-text">
                    A hybrid between <code>Enhanced Readout</code> and the default journey (origin/destination) display.<br>
                    Adds:<br>
                    <ul>
                    <li>Track (example: <code>T▼180°</code>)
                        <ul>
                            <li>The direction the aircraft is traveling over the ground (0° = North, 90° = East, etc.)</li>
                        </ul>
                    </li>
                    <li>Vertical speed (example: <code>V+1234</code>)
                        <ul>
                            <li>The rate of climb or descent (default: feet/min; meters/min if using Metric)</li>
                        </ul>
                    </li>
                    <li>RSSI - Received Signal Strength Index
                        <ul>
                            <li>How strong of a signal from the aircraft as detected from your receiver (in dBFS)</li>
                            <li>This takes the place of the Time (that the aircraft is airborne) readout in the bottom right</li>
                        </ul>
                    </li>
                    </ul>
                Recommended if you prefer information density.</div>
            </div>
            <div class="mt-3">
                <img src="{{ url_for('static', filename='FG-enhanced-readout.png') }}" class="inline-image">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ENHANCED_READOUT" name="ENHANCED_READOUT" {% if config.ENHANCED_READOUT %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="ENHANCED_READOUT">Enhanced Readout</label>
                </div>
                <div class="help-text">
                    Replaces the default journey (origin/destination) readout with:
                    <ul>
                        <li>Aircraft coordinates
                            <ul>
                                <li>Latitude and longitude</li>
                            </ul>
                        </li>
                        <li>Track</li>
                        <li>Vertical Speed</li>
                    </ul>
                    And swaps the Time readout in the bottom right with:
                    <ul>
                        <li>RSSI</li>
                    </ul>
                    When enabled, disables the API even if a valid key is present.<br>
                    If you're not using the API, it's recommended to enable this or leave the below setting enabled.
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ENHANCED_READOUT_AS_FALLBACK" name="ENHANCED_READOUT_AS_FALLBACK" {% if config.ENHANCED_READOUT_AS_FALLBACK %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="ENHANCED_READOUT_AS_FALLBACK">Enhanced Readout as Fallback</label>
                </div>
                <div class="help-text">
                    Switch to <code>Enhanced Readout</code> if API is unavailable or any of the API limits are reached.<br>
                    When the API can be used again, the display will switch back to the other layouts.<br>
                    Only works when <code>Enhanced Readout</code> is disabled.<br>
                    This setting is recommended to be left enabled unless you prefer the other layouts even when route information is unavailable.</div>
            </div>
            <div class="mt-3">
                <img src="{{ url_for('static', filename='FG-SHOWEVENMOREINFO-JourneyPlus.png') }}" class="inline-image">
                <img src="{{ url_for('static', filename='FG-SHOWEVENMOREINFO-EnhancedReadout.png') }}" class="inline-image">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="SHOW_EVEN_MORE_INFO" name="SHOW_EVEN_MORE_INFO" {% if config.SHOW_EVEN_MORE_INFO %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="SHOW_EVEN_MORE_INFO">Show Even More Info</label>
                </div>
                <div class="help-text">
                    Display additional info such as aircraft type, airline, owner, and journey details as a scrolling marquee/ticker.<br>
                    Only works with the <code>Journey Plus</code> or <code>Enhanced Readout</code> modes.<br>
                    When using <code>Journey Plus</code> :
                <ul>
                    <li>Replaces the center readout (Vertical Speed is unavailable)</li>
                    <li>Replaces RSSI with Track in the bottom right</li>
                </ul>
                Disable this feature if it's too distracting.
                </div>
            </div>
            <div class="mt-3">
                <img src="{{ url_for('static', filename='FG-clock-24hr.png') }}" class="inline-image">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="CLOCK_24HR" name="CLOCK_24HR" {% if config.CLOCK_24HR %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="CLOCK_24HR">24 Hour Clock</label>
                </div>
                <div class="help-text">When enabled, time is shown using 24 hours.</div>
            </div>
            <div class="mt-3">
                <img src="{{ url_for('static', filename='FG-default-journey.png') }}" class="inline-image">
                 <img src="{{ url_for('static', filename='FG-default-journey-alt.png') }}" class="inline-image">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ALTERNATIVE_FONT" name="ALTERNATIVE_FONT" {% if config.ALTERNATIVE_FONT %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="ALTERNATIVE_FONT">Alternative Font</label>
                </div>
                <div class="help-text">
                    Use a less squared-off font for the majority of the display's output.<br>
                    Helps when trying to distingush characters such as '0' vs 'O' or 'S' vs '5'.
                </div>
            </div>
            <div class="mt-3">
                <img src="{{ url_for('static', filename='FG-switch-progress-bar.png') }}" class="inline-image">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="DISPLAY_SWITCH_PROGRESS_BAR" name="DISPLAY_SWITCH_PROGRESS_BAR" {% if config.DISPLAY_SWITCH_PROGRESS_BAR %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="DISPLAY_SWITCH_PROGRESS_BAR">Display Switch Progress Bar</label>
                </div>
                <div class="help-text">Show a progress bar at the bottom of the aircraft info screen that represents how long the current aircraft will remain on display.<br>
                    Only appears when two (2) or more aircraft are present in the area.</div>
            </div>
            <img src="{{ url_for('static', filename='FG-clock-centerrow.png') }}" class="inline-image">
            <div class="mt-3">
                <label for="CLOCK_CENTER_ROW_ROW1" class="form-label setting-label">Clock Center Row 1</label>
                <div class="help-text">Select the main readout in the center section of the clock display.</div>
                <select class="form-select" id="CLOCK_CENTER_ROW_ROW1" name="CLOCK_CENTER_ROW_ROW1">
                    <option value="0" {% if config.CLOCK_CENTER_ROW.ROW1 == 0 %}selected{% endif %}>Don't use</option>
                    <option value="1" {% if config.CLOCK_CENTER_ROW.ROW1 == 1 %}selected{% endif %}>Sunset/Sunrise</option>
                    <option value="2" {% if config.CLOCK_CENTER_ROW.ROW1 == 2 %}selected{% endif %}>ADS-B receiver stats</option>
                    <option value="3" {% if config.CLOCK_CENTER_ROW.ROW1 == 3 %}selected{% endif %}>Extended calendar info</option>
                </select>
            </div>
            <div class="mt-3">
                <label for="CLOCK_CENTER_ROW_ROW2" class="form-label setting-label">Clock Center Row 2</label>
                <div class="help-text">
                    If this isn't set to "Don't use", add an additional line of info in the center section of the clock display.<br>
                    If the above setting is set to "Don't use" and this setting is set, this will force the use of a smaller font on the clock display.
                </div>
                <select class="form-select" id="CLOCK_CENTER_ROW_ROW2" name="CLOCK_CENTER_ROW_ROW2">
                    <option value="0" {% if config.CLOCK_CENTER_ROW.ROW2 == 0 %}selected{% endif %}>Don't use</option>
                    <option value="1" {% if config.CLOCK_CENTER_ROW.ROW2 == 1 %}selected{% endif %}>Sunset/Sunrise</option>
                    <option value="2" {% if config.CLOCK_CENTER_ROW.ROW2 == 2 %}selected{% endif %}>ADS-B receiver stats</option>
                    <option value="3" {% if config.CLOCK_CENTER_ROW.ROW2 == 3 %}selected{% endif %}>Extended calendar info</option>
                </select>
            </div>
        </div>
        <!-- Brightness Tab -->
        <div class="tab-pane fade" id="brightness" role="tabpanel">
            <div class="mt-3">
                <label for="BRIGHTNESS" class="form-label setting-label">Brightness</label>
                <div class="help-text">Set the default LED brightness.</div>
                <div class="input-group">
                    <input type="range" class="form-range" min="0" max="100" id="BRIGHTNESS" name="BRIGHTNESS" value="{{ config.BRIGHTNESS }}" oninput="BRIGHTNESS_value.value = this.value; BRIGHTNESS_num.value = this.value">
                    <!-- <input type="number" class="form-control" min="0" max="100" id="BRIGHTNESS_num" value="{{ config.BRIGHTNESS }}" style="max-width:100px; margin-left:8px;" oninput="BRIGHTNESS.value = this.value; BRIGHTNESS_value.value = this.value"> -->
                    <output id="BRIGHTNESS_value" style="margin-left:8px;">{{ config.BRIGHTNESS }}</output>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE" name="ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE" {% if config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS is not none and config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS != '' %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE">Active Plane Display Brightness</label>
                </div>
                <div class="help-text">
                    Use a different brightness when tracking an aircraft. Toggle to enable and set value.<br>
                    This setting is unaffected by <code>Dynamic Brightness</code>.
                </div>
                <div class="input-group">
                    <input type="range" class="form-range" min="0" max="100" id="ACTIVE_PLANE_DISPLAY_BRIGHTNESS" name="ACTIVE_PLANE_DISPLAY_BRIGHTNESS" value="{{ config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS if config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS is not none and config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS != '' else 50 }}" oninput="ACTIVE_PLANE_DISPLAY_BRIGHTNESS_value.value = this.value; ACTIVE_PLANE_DISPLAY_BRIGHTNESS_num.value = this.value" {% if config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS is none or config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS == '' %}disabled{% endif %}>
                    <!-- <input type="number" class="form-control" min="0" max="100" id="ACTIVE_PLANE_DISPLAY_BRIGHTNESS_num" value="{{ config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS if config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS is not none and config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS != '' else 50 }}" style="max-width:100px; margin-left:8px;" oninput="ACTIVE_PLANE_DISPLAY_BRIGHTNESS.value = this.value; ACTIVE_PLANE_DISPLAY_BRIGHTNESS_value.value = this.value" {% if config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS is none or config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS == '' %}disabled{% endif %}> -->
                    <output id="ACTIVE_PLANE_DISPLAY_BRIGHTNESS_value" style="margin-left:8px;">{{ config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS if config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS is not none and config.ACTIVE_PLANE_DISPLAY_BRIGHTNESS != '' else 50 }}</output>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ENABLE_TWO_BRIGHTNESS" name="ENABLE_TWO_BRIGHTNESS" {% if config.ENABLE_TWO_BRIGHTNESS %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="ENABLE_TWO_BRIGHTNESS">Dynamic Brightness</label>
                </div>
                <div class="help-text">
                    Enable dynamic switching of brightness based on time of day.<br>
                    If this setting is disabled, the below settings won't do anything.
                </div>
            </div>
            <div class="mt-3">
                <label for="BRIGHTNESS_2" class="form-label setting-label">Secondary Brightness</label>
                <div class="help-text">Used from sunset to sunrise ("night").</div>
                <div class="input-group">
                    <input type="range" class="form-range" min="0" max="100" id="BRIGHTNESS_2" name="BRIGHTNESS_2" value="{{ config.BRIGHTNESS_2 }}" oninput="BRIGHTNESS_2_value.value = this.value; BRIGHTNESS_2_num.value = this.value">
                    <!-- <input type="number" class="form-control" min="0" max="100" id="BRIGHTNESS_2_num" value="{{ config.BRIGHTNESS_2 }}" style="max-width:100px; margin-left:8px;" oninput="BRIGHTNESS_2.value = this.value; BRIGHTNESS_2_value.value = this.value"> -->
                    <output id="BRIGHTNESS_2_value" style="margin-left:8px;">{{ config.BRIGHTNESS_2 }}</output>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="USE_SUNRISE_SUNSET" name="USE_SUNRISE_SUNSET" {% if config.USE_SUNRISE_SUNSET %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="USE_SUNRISE_SUNSET">Use Sunrise/Sunset</label>
                </div>
                <div class="help-text">
                    Use sunrise and sunset times to adjust brightness.<br>
                    Overrides the below setting.
                </div>
            </div>
            <div class="mt-3">
                <label class="form-label setting-label">Brightness Switch Time</label>
                <div class="help-text">
                    Set the time of day to switch brightness levels.<br>
                    This setting is the fallback in case sunrise and sunset times can't be determined for your location.<br>
                </div>
                <div class="row g-2">
                    <div class="col">
                        <label for="BRIGHTNESS_SWITCH_TIME_Sunrise" class="form-label">Sunrise</label>
                        <input type="time" class="form-control" id="BRIGHTNESS_SWITCH_TIME_Sunrise" name="BRIGHTNESS_SWITCH_TIME_Sunrise" value="{{ config.BRIGHTNESS_SWITCH_TIME.Sunrise }}" required>
                    </div>
                    <div class="col">
                        <label for="BRIGHTNESS_SWITCH_TIME_Sunset" class="form-label">Sunset</label>
                        <input type="time" class="form-control" id="BRIGHTNESS_SWITCH_TIME_Sunset" name="BRIGHTNESS_SWITCH_TIME_Sunset" value="{{ config.BRIGHTNESS_SWITCH_TIME.Sunset }}" required>
                    </div>
                </div>
            </div>
        </div>
        <!-- Advanced Tab -->
        <div class="tab-pane fade" id="advanced" role="tabpanel">
            <div class="mt-3">
                <label for="FLYBY_STALENESS" class="form-label setting-label">Flyby Staleness</label>
                <div class="help-text">
                    Time in minutes before a flyby is considered new.<br>
                    Affects the daily flyby count and number of API calls in a day.<br>
                    <i>If you're near an airport, setting this lower than 60 can give you more accurate results.</i><br>
                    <i>Default: 60</i>
                </div>
                <div class="input-group">
                    <input type="range" class="form-range" min="2" max="1440" id="FLYBY_STALENESS" name="FLYBY_STALENESS" value="{{ config.FLYBY_STALENESS }}" oninput="FLYBY_STALENESS_num.value = this.value">
                    <input type="number" class="form-control" min="2" max="1440" id="FLYBY_STALENESS_num" value="{{ config.FLYBY_STALENESS }}" style="max-width:100px; margin-left:8px;" oninput="FLYBY_STALENESS.value = this.value; FLYBY_STALENESS_value.value = this.value">
                    <!-- <output id="FLYBY_STALENESS_value" style="margin-left:8px;">{{ config.FLYBY_STALENESS }}</output> -->
                </div>
            </div>
            <div class="mt-3">
                <label for="LOCATION_TIMEOUT" class="form-label setting-label">Location Timeout</label>
                <div class="help-text">
                    Time in seconds before an aircraft's location is considered stale and is discarded from the total tracking count.<br>
                    <i>Default: 60</i>
                </div>
                <div class="input-group">
                    <input type="range" class="form-range" min="15" max="60" id="LOCATION_TIMEOUT" name="LOCATION_TIMEOUT" value="{{ config.LOCATION_TIMEOUT }}" oninput="LOCATION_TIMEOUT_value.value = this.value; LOCATION_TIMEOUT_num.value = this.value">
                    <!-- <input type="number" class="form-control" min="15" max="60" id="LOCATION_TIMEOUT_num" value="{{ config.LOCATION_TIMEOUT }}" style="max-width:100px; margin-left:8px;" oninput="LOCATION_TIMEOUT.value = this.value; LOCATION_TIMEOUT_value.value = this.value"> -->
                    <output id="LOCATION_TIMEOUT_value" style="margin-left:8px;">{{ config.LOCATION_TIMEOUT }}</output>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="PREFER_LOCAL" name="PREFER_LOCAL" {% if config.PREFER_LOCAL %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="PREFER_LOCAL">Prefer Local</label>
                </div>
                <div class="help-text">
                    Read dump1090 data from local file system first.<br>
                    Disable this if you're using a custom dump1090 location.<br>
                    <i>Default: Enabled</i>
                </div>
            </div>
            <div class="mt-3">
                <label for="CUSTOM_DUMP1090_LOCATION" class="form-label setting-label">Custom dump1090 Location</label>
                <div class="help-text">
                    URL of your dump1090 install if it's in a different location or on a different network device.<br>
                    Leave this blank to not use this feature.<br>
                    <i>Example: http://localhost/custom_name_here</i> or <i>http://192.168.xxx.xxx:8080 (no trailing /)</i>
                </div>
                <input type="text" class="form-control" id="CUSTOM_DUMP1090_LOCATION" name="CUSTOM_DUMP1090_LOCATION" value="{{ config.CUSTOM_DUMP1090_LOCATION }}" style="font-family: monospace;">
            </div>
            <div class="mt-3">
                <label for="CUSTOM_DUMP978_LOCATION" class="form-label setting-label">Custom dump978 Location</label>
                <div class="help-text">
                    URL of your dump978 install if it's in a different location or on a different network device.<br>
                    Leave this blank to not use this feature.<br>
                    <i>Example: http://192.168.xxx.xxx:8978</i>
                </div>
                <input type="text" class="form-control" id="CUSTOM_DUMP978_LOCATION" name="CUSTOM_DUMP978_LOCATION" value="{{ config.CUSTOM_DUMP978_LOCATION }}" style="font-family: monospace;">
            </div>
            <div class="mt-3">
                <label for="FOLLOW_THIS_AIRCRAFT" class="form-label setting-label">Follow This Aircraft</label>
                <div class="help-text">
                    ICAO hex ID of a specific aircraft to follow. Leave this blank to not use this feature.<br>
                    When this aircraft enters the reception area for your ADS-B receiver (not the values set by <code>Height Limit</code> or <code>Range</code>),<br>
                    FlightGazer will start tracking it as if it were inside your designated <code>Range</code>.<br>
                    When tracking this aircraft, <code>Enhanced Readout</code> will be used regardless of the setting for that option<br>
                    and will append a "*" on the aircraft's callsign. This does not disable API use when this aircraft is being tracked.
                </div>
                <input type="text" class="form-control" id="FOLLOW_THIS_AIRCRAFT" name="FOLLOW_THIS_AIRCRAFT" value="{{ config.FOLLOW_THIS_AIRCRAFT }}" style="font-family: monospace;" maxlength="6" pattern="[0-9a-fA-F]+">
                <style>
                input:invalid {
                border: red solid 3px;
                }
                </style>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="FASTER_REFRESH" name="FASTER_REFRESH" {% if config.FASTER_REFRESH %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="FASTER_REFRESH">Faster Refresh</label>
                </div>
                <div class="help-text">Decrease dump1090 polling time to 1 second (increases CPU load).</div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="FLYBY_STATS_ENABLED" name="FLYBY_STATS_ENABLED" {% if config.FLYBY_STATS_ENABLED %}checked{% endif %} disabled>
                    <label class="form-check-label setting-label" for="FLYBY_STATS_ENABLED" style="pointer-events:none;opacity:0.6;">Flyby Stats Enabled</label>
                </div>
                <div class="help-text" style="opacity:0.7;">
                    Save general stats of aircraft flybys and API usage to a CSV file.<br>
                    <i>You must modify the configuration file directly to change this.</i>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="WRITE_STATE" name="WRITE_STATE" {% if config.WRITE_STATE %}checked{% endif %} disabled>
                    <label class="form-check-label setting-label" for="WRITE_STATE" style="pointer-events:none;opacity:0.6;">Write State</label>
                </div>
                <div class="help-text" style="opacity:0.7;">
                    Write a JSON file of current operating state.<br>
                    <i>You must modify the configuration file directly to change this.</i>
                </div>
            </div>
        </div>
        <!-- RGB-Matrix Tab -->
        <div class="tab-pane fade" id="rgb" role="tabpanel">
            <div class="mt-3">
                <label><h4>WARNING! Changing these settings may cause your display to not work!</h4></label>
            </div>
            <div class="mt-3">
                <label for="GPIO_SLOWDOWN" class="form-label setting-label">GPIO Slowdown</label>
                <div class="help-text">
                    Set for your setup. Higher values are used for faster Raspberry Pi's.<br>
                    <i>Default: 2</i>
                </div>
                <div class="input-group">
                    <input type="range" class="form-range" min="0" max="4" id="GPIO_SLOWDOWN" name="GPIO_SLOWDOWN" value="{{ config.GPIO_SLOWDOWN }}" oninput="GPIO_SLOWDOWN_value.value = this.value">
                    <!-- <input type="number" class="form-control" min="0" max="4" id="GPIO_SLOWDOWN_num" value="{{ config.GPIO_SLOWDOWN }}" style="max-width:100px; margin-left:8px;" oninput="GPIO_SLOWDOWN.value = this.value; GPIO_SLOWDOWN_value.value = this.value"> -->
                    <output id="GPIO_SLOWDOWN_value" style="margin-left:8px;">{{ config.GPIO_SLOWDOWN }}</output>
                </div>
            </div>
            <div class="mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="HAT_PWM_ENABLED" name="HAT_PWM_ENABLED" {% if config.HAT_PWM_ENABLED %}checked{% endif %}>
                    <label class="form-check-label setting-label" for="HAT_PWM_ENABLED">HAT PWM Enabled</label>
                </div>
                <div class="help-text">
                    Enable this if the quality modification for the RGB-Matrix Bonnet is present.<br>
                    <i>Default: Enabled</i>
                </div>
            </div>
            <div class="mt-3">
                <label for="LED_PWM_BITS" class="form-label setting-label">LED PWM Bits</label>
                <div class="help-text">
                    Lower values enable higher refresh rates on the physical RGB-Matrix but there is less color depth.<br>
                    <i>Should be left at '8' (default) in most cases.</i>
                </div>
                <div class="input-group">
                    <input type="range" class="form-range" min="1" max="11" id="LED_PWM_BITS" name="LED_PWM_BITS" value="{{ config.LED_PWM_BITS }}" oninput="LED_PWM_BITS_value.value = this.value">
                    <!-- <input type="number" class="form-control" min="1" max="11" id="LED_PWM_BITS_num" value="{{ config.LED_PWM_BITS }}" style="max-width:100px; margin-left:8px;" oninput="LED_PWM_BITS.value = this.value; LED_PWM_BITS_value.value = this.value"> -->
                    <output id="LED_PWM_BITS_value" style="margin-left:8px;">{{ config.LED_PWM_BITS }}</output>
                </div>
            </div>
        </div>
        <!-- Colors Tab -->
        <div class="tab-pane fade" id="colors" role="tabpanel">
        <div class="help-text"><i>Tip: To hide screen elements, select 'BLACK'.</i></div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Clock Colors</h5>
                <img src="{{ url_for('static', filename='FG-clock.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('clock_color', 'Clock'),
            ('seconds_color', 'Seconds'),
            ('am_pm_color', 'AM/PM'),
            ('day_of_week_color', 'Day of Week'),
            ('date_color', 'Date'),
            ('flyby_header_color', 'Flyby Header'),
            ('flyby_color', 'Flyby'),
            ('track_header_color', 'Track Header'),
            ('track_color', 'Track'),
            ('range_header_color', 'Range Header'),
            ('range_color', 'Range'),
            ('center_row1_color', 'Center Row 1'),
            ('center_row2_color', 'Center Row 2')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Plane Readout Colors</h5>
                <img src="{{ url_for('static', filename='FG-plane-readout.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('callsign_color', 'Callsign'),
            ('distance_color', 'Distance'),
            ('country_color', 'Country'),
            ('uat_indicator_color', 'UAT Indicator')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Journey Colors</h5>
                <img src="{{ url_for('static', filename='FG-default-journey-journey.png') }}" class="inline-image">
                <img src="{{ url_for('static', filename='FG-journey-plus-journey.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('origin_color', 'Origin'),
            ('destination_color', 'Destination'),
            ('arrow_color', 'Arrow')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Journey Plus Colors</h5>
                <img src="{{ url_for('static', filename='FG-journey-plus-colors.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('time_header_color', 'Time Header'),
            ('time_readout_color', 'Time Readout'),
            ('center_readout_color', 'Center Readout')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Enhanced Readout Colors</h5>
                <img src="{{ url_for('static', filename='FG-enhanced-readout-colors.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('latitude_color', 'Latitude'),
            ('longitude_color', 'Longitude'),
            ('groundtrack_color', 'Ground Track'),
            ('verticalspeed_color', 'Vertical Speed')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Scrolling Info Line</h5>
                <img src="{{ url_for('static', filename='FG-SHOWEVENMOREINFO-JourneyPlus.png') }}" class="inline-image">
                <img src="{{ url_for('static', filename='FG-SHOWEVENMOREINFO-EnhancedReadout.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('marquee_color_journey_plus', 'Marquee (Journey Plus)'),
            ('marquee_color_enhanced_readout', 'Marquee (Enhanced Readout)')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Stats at the Bottom</h5>
                <img src="{{ url_for('static', filename='FG-bottom-stats.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('altitude_heading_color', 'Altitude Heading'),
            ('altitude_color', 'Altitude'),
            ('speed_heading_color', 'Speed Heading'),
            ('speed_color', 'Speed'),
            ('time_rssi_heading_color', 'Time/RSSI Heading'),
            ('time_rssi_color', 'Time/RSSI')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        <div class="mt-3">
            <div style="text-align: center; margin-bottom: 24px;">
                <h5>Plane Count Indicator</h5>
                <img src="{{ url_for('static', filename='FG-plane-count-indicator.png') }}" class="inline-image">
            </div>
            {% for var, label in [
            ('plane_count_color', 'Plane Count'),
            ('switch_progress_color', 'Switch Progress')
            ] %}
            <div class="row align-items-center mb-2">
            <div class="col-4">
                <label class="form-label">{{ label }}</label>
            </div>
            <div class="col-5 d-flex align-items-center" style="width: 60%;">
                <select class="form-select color-select me-2" data-var="{{ var }}" id="{{ var }}">
                {% for cname in predefined_colors %}
                    <option value="{{ cname }}" data-color="{{ predefined_colors_rgb[cname] }}" {% if color_config[var]['type']=='predef' and color_config[var]['value']==cname %}selected{% endif %}>{{ cname }}</option>
                {% endfor %}
                <option value="custom" {% if color_config[var]['type']=='custom' %}selected{% endif %}>Custom...</option>
                </select>
                <input type="color" class="form-control form-control-color color-picker ms-2" id="{{ var }}_picker" value="{{ color_config[var]['hex'] if color_config[var]['type']=='custom' else '#ffffff' }}" style="display: {% if color_config[var]['type']=='custom' %}inline-block{% else %}none{% endif %};">
                <span class="color-preview ms-2" id="{{ var }}_preview" style="width: 2em; height: 2em; display: inline-block; border: 1px solid #ccc; border-radius: 4px; background: {{ color_config[var]['hex'] if color_config[var]['type']=='custom' else predefined_colors_rgb.get(color_config[var]['value'], '#fff') }};"></span>
            </div>
            </div>
            {% endfor %}
        </div>
        </div>
    </div>
    <button type="button" class="btn btn-primary apply-btn" id="applyBtn" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)">Save Settings</button>
    <button type="button" class="btn btn-warning" id="restartReminderBtn" style="display:none; position:fixed; bottom:72px; right:24px; z-index:9999; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)">Restart FlightGazer to apply changes</button>
    </form>
    <button id="themeToggleBtn" class="btn btn-sm btn-outline-info mb-3 float-end" style="position:absolute;top:18px;right:24px;z-index:10;">☀️🌙</button>
</div>
<script src="{{ url_for('static', filename='bootstrap-bundle-min.js') }}"></script>
<script src="{{ url_for('static', filename='jquery-3.6.0-min.js') }}"></script>
<script>
const updateConfigURL = "{{ url_for('update_config') }}";
const restartService = "{{ url_for('restart_flightgazer') }}";
$(document).ready(function() {
    // Dynamically adjust HEIGHT_LIMIT and RANGE min/max based on selected units
    function updateLimits() {
        var units = parseInt($('#UNITS').val());
        // HEIGHT_LIMIT
        var heightMin, heightMax, heightStep, altitudeUnit;
        if (units === 1) { // metric
            heightMin = 760;
            heightMax = 22860;
            heightStep = 5;
            altitudeUnit = 'meters';
        } else { // aeronautical or imperial
            heightMin = 2500;
            heightMax = 75000;
            heightStep = 5;
            altitudeUnit = 'feet';
        }
        $('#HEIGHT_LIMIT, #HEIGHT_LIMIT_num').attr({min: heightMin, max: heightMax, step: heightStep});
        $('#aUnit').text(altitudeUnit);
        // Clamp value if out of bounds
        var hVal = parseInt($('#HEIGHT_LIMIT').val());
        if (hVal < heightMin || hVal > heightMax || isNaN(hVal)) {
            $('#HEIGHT_LIMIT').val(heightMin);
            $('#HEIGHT_LIMIT_num').val(heightMin);
        }
        // RANGE
        var rangeMin, rangeMax, rangeStep, distanceUnit;
        switch(units) {
            case 1: // metric
            rangeMin = 0.9;
            rangeMax = 37;
            rangeStep = 0.1;
            distanceUnit = 'km';
            break;
            case 2: // imperial
            rangeMin = 0.6;
            rangeMax = 23;
            rangeStep = 0.1;
            distanceUnit = 'mi';
            break;
            default: // aeronautical or anything else
            rangeMin = 0.5;
            rangeMax = 20;
            rangeStep = 0.1;
            distanceUnit = 'nmi';
        }
        $('#RANGE, #RANGE_num').attr({min: rangeMin, max: rangeMax, step: rangeStep});
        $('#dUnit').text(distanceUnit);
        var rVal = parseFloat($('#RANGE').val());
        if (rVal < rangeMin || rVal > rangeMax || isNaN(rVal)) {
            $('#RANGE').val(rangeMin);
            $('#RANGE_num').val(rangeMin);
        }
    }
    $('#UNITS').on('change', function() {
        updateLimits();
    });
    // Initial call
    updateLimits();
    // Colors tab logic
    $('.color-select').on('change', function() {
        var v = $(this).val();
        var picker = $('#' + $(this).attr('id') + '_picker');
        var preview = $('#' + $(this).attr('id') + '_preview');
        if (v === 'custom') {
            picker.show();
            preview.css('background', picker.val());
        } else {
            picker.hide();
            // get color from option's data-color
            var hex = $(this).find('option:selected').data('color');
            preview.css('background', hex);
        }
        $('#applyBtn').show();
    });
    $('.color-picker').on('input', function() {
        var preview = $('#' + $(this).attr('id').replace('_picker','_preview'));
        preview.css('background', $(this).val());
        $('#applyBtn').show();
    });
    $('#configForm').on('input change', function() {
        $('#applyBtn').show();
    });
    // Warn user if navigating away with unsaved changes
    window.addEventListener('beforeunload', function(e) {
        if ($('#applyBtn').is(':visible')) {
            e.preventDefault();
            e.returnValue = '';
            return '';
        }
    });
    function getApiSchedule() {
        let schedule = {};
        ["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"].forEach(day => {
            let am = '', pm = '';
            for (let h = 0; h < 12; h++) {
                am += $(".api-hour[data-day='"+day+"'][data-hour='"+h+"']").is(':checked') ? 'x' : '-';
                pm += $(".api-hour[data-day='"+day+"'][data-hour='"+(h+12)+"']").is(':checked') ? 'x' : '-';
            }
            schedule[day] = {'0-11': am, '12-23': pm};
        });
        schedule['ENABLED'] = $('#API_SCHEDULE_ENABLED').is(':checked');
        return schedule;
    }
    $('#applyBtn').on('click', function() {
        let form = $('#configForm')[0];
        let errors = [];
        // Programmer's note: uncomment these if you decide to check these settings later
        // do some basic input verification
        // // Height Limit
        // let heightLimit = parseInt(form.HEIGHT_LIMIT.value);
        // if (isNaN(heightLimit) || heightLimit < 2500 || heightLimit > 75000) {
        //     errors.push('Height Limit must be between 2500 and 75000.');
        // }
        // // Range
        // let range = parseFloat(form.RANGE.value);
        // if (isNaN(range) || range < 0.5 || range > 20) {
        //     errors.push('Range must be between 0.5 and 20.');
        // }
        // // Brightness
        // let brightness = parseInt(form.BRIGHTNESS.value);
        // if (isNaN(brightness) || brightness < 0 || brightness > 100) {
        //     errors.push('Brightness must be between 0 and 100.');
        // }
        // // Secondary Brightness
        // if (form.BRIGHTNESS_2) {
        //     let brightness2 = parseInt(form.BRIGHTNESS_2.value);
        //     if (isNaN(brightness2) || brightness2 < 0 || brightness2 > 100) {
        //         errors.push('Secondary Brightness must be between 0 and 100.');
        //     }
        // }
        // // Active Plane Display Brightness
        // if ($('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE').is(':checked')) {
        //     let apdb = parseInt(form.ACTIVE_PLANE_DISPLAY_BRIGHTNESS.value);
        //     if (isNaN(apdb) || apdb < 0 || apdb > 100) {
        //         errors.push('Active Plane Display Brightness must be between 0 and 100.');
        //     }
        // }
        // // Flyby Staleness
        // let flybyStaleness = parseInt(form.FLYBY_STALENESS.value);
        // if (isNaN(flybyStaleness) || flybyStaleness < 2 || flybyStaleness > 1440) {
        //     errors.push('Flyby Staleness must be between 2 and 1440.');
        // }
        // // Location Timeout
        // let locationTimeout = parseInt(form.LOCATION_TIMEOUT.value);
        // if (isNaN(locationTimeout) || locationTimeout < 15 || locationTimeout > 60) {
        //     errors.push('Location Timeout must be between 15 and 60.');
        // }
        // // GPIO Slowdown
        // let gpioSlowdown = parseInt(form.GPIO_SLOWDOWN.value);
        // if (isNaN(gpioSlowdown) || gpioSlowdown < 0 || gpioSlowdown > 4) {
        //     errors.push('GPIO Slowdown must be between 0 and 4.');
        // }
        // // LED PWM Bits
        // if (form.LED_PWM_BITS) {
        //     let ledPwmBits = parseInt(form.LED_PWM_BITS.value);
        //     if (isNaN(ledPwmBits) || ledPwmBits < 1 || ledPwmBits > 11) {
        //         errors.push('LED PWM Bits must be between 1 and 11.');
        //     }
        // }

        // API Daily Limit
        if (form.API_DAILY_LIMIT.value) {
            let apiDailyLimit = parseInt(form.API_DAILY_LIMIT.value);
            if (isNaN(apiDailyLimit) || apiDailyLimit < 1 || apiDailyLimit > 10000) {
                errors.push('API Daily Limit must be between 1 and 10000.');
            }
        }
        // API Cost Limit
        if (form.API_COST_LIMIT.value) {
            let apiCostLimit = parseFloat(form.API_COST_LIMIT.value);
            if (isNaN(apiCostLimit) || apiCostLimit < 0.01 || apiCostLimit > 10000) {
                errors.push('API Cost Limit must be between 0.01 and 10000.');
            }
        }
        // Custom dump1090 location (basic URL check)
        if (form.CUSTOM_DUMP1090_LOCATION.value && !/^https?:\/\/.+/.test(form.CUSTOM_DUMP1090_LOCATION.value)) {
            errors.push('Custom dump1090 location must be a valid URL starting with http:// or https://');
        }
        // Custom dump978 location (basic URL check)
        if (form.CUSTOM_DUMP978_LOCATION.value && !/^https?:\/\/.+/.test(form.CUSTOM_DUMP978_LOCATION.value)) {
            errors.push('Custom dump978 location must be a valid URL starting with http:// or https://');
        }
        // Follow This Aircraft (hex check)
        if (form.FOLLOW_THIS_AIRCRAFT.value && !/^[0-9a-fA-F]{1,6}$/.test(form.FOLLOW_THIS_AIRCRAFT.value)) {
            errors.push('Follow This Aircraft must be a valid ICAO hex ID (6 hex digits).');
        }
        if (form.FOLLOW_THIS_AIRCRAFT.value && (form.FOLLOW_THIS_AIRCRAFT.value).length != 6) {
            errors.push('Follow This Aircraft must be exactly 6 characters.')
        }
        // Brightness Switch Time
        if (form.BRIGHTNESS_SWITCH_TIME_Sunrise && form.BRIGHTNESS_SWITCH_TIME_Sunset) {
            let sunrise = form.BRIGHTNESS_SWITCH_TIME_Sunrise.value;
            let sunset = form.BRIGHTNESS_SWITCH_TIME_Sunset.value;
            // Check for valid HH:MM format
            let timeRegex = /^([01]\d|2[0-3]):[0-5]\d$/;
            if (!timeRegex.test(sunrise)) {
                errors.push('Sunrise time must be in HH:MM format (00:00 to 23:59).');
            }
            if (!timeRegex.test(sunset)) {
                errors.push('Sunset time must be in HH:MM format (00:00 to 23:59).');
            }
            // Check that sunrise != sunset
            if (sunrise && sunset && sunrise === sunset) {
                errors.push('Sunrise and Sunset times must be different.');
            }
            // Check that sunrise does not occur after sunset
            if (sunrise && sunset && timeRegex.test(sunrise) && timeRegex.test(sunset)) {
                let sunriseParts = sunrise.split(':');
                let sunsetParts = sunset.split(':');
                let sunriseMinutes = parseInt(sunriseParts[0], 10) * 60 + parseInt(sunriseParts[1], 10);
                let sunsetMinutes = parseInt(sunsetParts[0], 10) * 60 + parseInt(sunsetParts[1], 10);
                if (sunriseMinutes > sunsetMinutes) {
                    errors.push('Sunrise time must occur before Sunset time.');
                }
            }
        }
        if (errors.length > 0) {
            alert('Please correct the following errors before saving:\n\n' + errors.join('\n'));
            return;
        }
        let data = {};
        data['UNITS'] = parseInt(form.UNITS.value);
        data['HEIGHT_LIMIT'] = parseInt(form.HEIGHT_LIMIT.value);
        data['RANGE'] = parseFloat(form.RANGE.value);
        data['API_KEY'] = form.API_KEY.value;
        data['API_DAILY_LIMIT'] = form.API_DAILY_LIMIT.value ? parseInt(form.API_DAILY_LIMIT.value) : null;
        data['API_COST_LIMIT'] = form.API_COST_LIMIT.value ? parseFloat(form.API_COST_LIMIT.value) : null;
        data['API_SCHEDULE'] = getApiSchedule();
        // Always send all boolean settings (checkboxes)
        data['JOURNEY_PLUS'] = form.JOURNEY_PLUS && form.JOURNEY_PLUS.checked;
        data['ENHANCED_READOUT'] = form.ENHANCED_READOUT && form.ENHANCED_READOUT.checked;
        data['ENHANCED_READOUT_AS_FALLBACK'] = form.ENHANCED_READOUT_AS_FALLBACK && form.ENHANCED_READOUT_AS_FALLBACK.checked;
        data['SHOW_EVEN_MORE_INFO'] = form.SHOW_EVEN_MORE_INFO && form.SHOW_EVEN_MORE_INFO.checked;
        data['CLOCK_24HR'] = form.CLOCK_24HR && form.CLOCK_24HR.checked;
        data['ALTERNATIVE_FONT'] = form.ALTERNATIVE_FONT && form.ALTERNATIVE_FONT.checked;
        data['DISPLAY_SWITCH_PROGRESS_BAR'] = form.DISPLAY_SWITCH_PROGRESS_BAR && form.DISPLAY_SWITCH_PROGRESS_BAR.checked;
        data['ENABLE_TWO_BRIGHTNESS'] = form.ENABLE_TWO_BRIGHTNESS && form.ENABLE_TWO_BRIGHTNESS.checked;
        data['USE_SUNRISE_SUNSET'] = form.USE_SUNRISE_SUNSET && form.USE_SUNRISE_SUNSET.checked;
        data['PREFER_LOCAL'] = form.PREFER_LOCAL && form.PREFER_LOCAL.checked;
        data['HAT_PWM_ENABLED'] = form.HAT_PWM_ENABLED && form.HAT_PWM_ENABLED.checked;
        data['FASTER_REFRESH'] = form.FASTER_REFRESH && form.FASTER_REFRESH.checked;
        data['FLYBY_STATS_ENABLED'] = form.FLYBY_STATS_ENABLED && form.FLYBY_STATS_ENABLED.checked;
        data['WRITE_STATE'] = form.WRITE_STATE && form.WRITE_STATE.checked;
        data['BRIGHTNESS'] = parseInt(form.BRIGHTNESS.value);
        if ($('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE').is(':checked')) {
            data['ACTIVE_PLANE_DISPLAY_BRIGHTNESS'] = parseInt(form.ACTIVE_PLANE_DISPLAY_BRIGHTNESS.value);
        } else {
            data['ACTIVE_PLANE_DISPLAY_BRIGHTNESS'] = '';
        }
        if (form.BRIGHTNESS_2) data['BRIGHTNESS_2'] = parseInt(form.BRIGHTNESS_2.value);
        if (form.BRIGHTNESS_SWITCH_TIME_Sunrise && form.BRIGHTNESS_SWITCH_TIME_Sunset) {
            data['BRIGHTNESS_SWITCH_TIME'] = {
                'Sunrise': form.BRIGHTNESS_SWITCH_TIME_Sunrise.value,
                'Sunset': form.BRIGHTNESS_SWITCH_TIME_Sunset.value
            };
        }
        data['FLYBY_STALENESS'] = parseInt(form.FLYBY_STALENESS.value);
        data['LOCATION_TIMEOUT'] = parseInt(form.LOCATION_TIMEOUT.value);
        data['GPIO_SLOWDOWN'] = parseInt(form.GPIO_SLOWDOWN.value);
        data['CUSTOM_DUMP1090_LOCATION'] = form.CUSTOM_DUMP1090_LOCATION.value;
        data['CUSTOM_DUMP978_LOCATION'] = form.CUSTOM_DUMP978_LOCATION.value;
        data['FOLLOW_THIS_AIRCRAFT'] = form.FOLLOW_THIS_AIRCRAFT.value;
        data['CLOCK_CENTER_ROW'] = {
            'ROW1': parseInt(form.CLOCK_CENTER_ROW_ROW1.value),
            'ROW2': parseInt(form.CLOCK_CENTER_ROW_ROW2.value)
        };
        data['LED_PWM_BITS'] = parseInt(form.LED_PWM_BITS.value);
        // Colors
        let colorVars = [
            'clock_color','seconds_color','am_pm_color','day_of_week_color','date_color',
            'flyby_header_color','flyby_color','track_header_color','track_color','range_header_color','range_color',
            'center_row1_color','center_row2_color',
            'callsign_color','distance_color','country_color','uat_indicator_color',
            'origin_color','destination_color','arrow_color',
            'time_header_color','time_readout_color','center_readout_color',
            'latitude_color','longitude_color','groundtrack_color','verticalspeed_color',
            'marquee_color_journey_plus','marquee_color_enhanced_readout',
            'altitude_heading_color','altitude_color','speed_heading_color','speed_color','time_rssi_heading_color','time_rssi_color',
            'plane_count_color','switch_progress_color'
        ];
        let colorData = {};
        colorVars.forEach(function(varname) {
            let sel = $('#' + varname);
            if (sel.length === 0) return;
            let val = sel.val();
            if (val === 'custom') {
                let hex = $('#' + varname + '_picker').val();
                colorData[varname] = {type: 'custom', hex: hex};
            } else {
                colorData[varname] = {type: 'predef', value: val};
            }
        });
        data['colors'] = colorData;
        $.ajax({
            url: updateConfigURL,
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(resp) {
                $('#applyBtn').hide();
                // Prompt user to restart FlightGazer
                if (confirm('Settings saved. Restart FlightGazer now to apply changes?')) {
                    showSpinnerOverlay('Restarting FlightGazer...');
                    $.post(restartService, function(restartResp) {
                        hideSpinnerOverlay();
                        if (restartResp.status === 'success') {
                            alert('FlightGazer successfully restarted.');
                        } else {
                            alert('Failed to restart FlightGazer. Check the logs.');
                        }
                        location.reload();
                    });
                } else {
                    // Show persistent reminder button
                    $('#restartReminderBtn').show();
                }
            },
            error: function() {
                alert('Failed to save config! Your changes may not have been saved.');
            }
        });
    });
    // Persistent restart reminder button logic
    $('#restartReminderBtn').on('click', function() {
        if (confirm('Restart FlightGazer now to apply your changes?')) {
            showSpinnerOverlay('Restarting FlightGazer...');
            $.post(restartService, function(restartResp) {
                hideSpinnerOverlay();
                if (restartResp.status === 'success') {
                    alert('FlightGazer successfully restarted.');
                } else {
                    alert('Failed to restart FlightGazer. Check the logs.');
                }
                location.reload();
            });
        }
    });
    // Active Plane Display Brightness toggle logic
    function updateActivePlaneSliderState() {
        if ($('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE').is(':checked')) {
            $('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS').prop('disabled', false);
        } else {
            $('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS').prop('disabled', true);
        }
    }
    // Set initial state on page load
    updateActivePlaneSliderState();
    $('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS_TOGGLE').on('change', function() {
        updateActivePlaneSliderState();
        $('#applyBtn').show();
    });
    $('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS').on('input', function() {
        $('#ACTIVE_PLANE_DISPLAY_BRIGHTNESS_value').val($(this).val());
        $('#applyBtn').show();
    });
    // Theme switcher logic
    function setTheme(theme) {
        if (theme === 'light') {
            document.body.style.background = '#f8f9fa';
            document.body.style.color = '#222';
            let alerts = document.querySelectorAll('.alert');
            alerts.forEach(a => { a.style.background = '#fffbe6'; a.style.color = '#b58900'; });
        } else {
            document.body.style.background = '#181818';
            document.body.style.color = '#fff';
            let alerts = document.querySelectorAll('.alert');
            alerts.forEach(a => { a.style.background = '#222'; a.style.color = '#ffd700'; });
        }
    }
    function getPreferredTheme() {
        if (localStorage.getItem('fg_theme')) return localStorage.getItem('fg_theme');
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    function toggleTheme() {
        let current = getPreferredTheme();
        let next = current === 'dark' ? 'light' : 'dark';
        localStorage.setItem('fg_theme', next);
        setTheme(next);
    }
    document.getElementById('themeToggleBtn').onclick = toggleTheme;
    setTheme(getPreferredTheme());
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem('fg_theme')) setTheme(e.matches ? 'dark' : 'light');
    });
// Spinner overlay logic
function showSpinnerOverlay(message) {
    if ($('#spinnerOverlay').length) return;
    let overlay = $(`
        <div id="spinnerOverlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(24,24,24,0.85);z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;">
            <div style="margin-bottom:24px;color:#fff;font-size:1.3em;">${message || 'Please wait...'}</div>
            <div class="spinner-border text-info" style="width:4rem;height:4rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    `);
    $('body').append(overlay);
}
function hideSpinnerOverlay() {
    $('#spinnerOverlay').remove();
}
});
</script>
</body>
</html>
